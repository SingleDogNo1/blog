{"title":"从零搭建Vue UI组件库(三)","slug":"从零搭建Vue UI组件库(三)","date":"2021-04-15T08:42:30.000Z","updated":"2023-06-21T08:55:09.214Z","comments":true,"path":"api/articles/从零搭建Vue UI组件库(三).json","excerpt":null,"covers":null,"content":"<h2 id=\"加入-typescript-sass\"><a href=\"#加入-typescript-sass\" class=\"headerlink\" title=\"加入 typescript/sass\"></a>加入 typescript/sass</h2><h3 id=\"添加-typescript、ts-loader、sass、sass-loader\"><a href=\"#添加-typescript、ts-loader、sass、sass-loader\" class=\"headerlink\" title=\"添加 typescript、ts-loader、sass、sass-loader\"></a>添加 typescript、ts-loader、sass、sass-loader</h3><div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">PLAIN</span></header><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add -D typescript ts-loader sass sass-loader -W</span><br></pre></td></tr></table></figure></div>\n<blockquote>\n<p><a href=\"mailto:ts-loader@8.1.0\" target=\"_blank\" rel=\"noopener\">ts-loader@8.1.0</a> 报错，这里选择了 v8.0.3; <a href=\"mailto:sass-loader@11.0.1\" target=\"_blank\" rel=\"noopener\">sass-loader@11.0.1</a>报错，选择了 v10.1.1,如果你的 loader 运行没有报错可以忽略。</p>\n</blockquote>\n<h3 id=\"添加-tsconfig-json\"><a href=\"#添加-tsconfig-json\" class=\"headerlink\" title=\"添加 tsconfig.json\"></a>添加 tsconfig.json</h3><div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">JSON</span></header><figure class=\"iseeu highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"compilerOptions\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"module\"</span>: <span class=\"string\">\"ESNext\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"declaration\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"noImplicitAny\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"removeComments\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"moduleResolution\"</span>: <span class=\"string\">\"node\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"esModuleInterop\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"jsx\"</span>: <span class=\"string\">\"preserve\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"noLib\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"target\"</span>: <span class=\"string\">\"es6\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"baseUrl\"</span>: <span class=\"string\">\".\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"sourceMap\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"lib\"</span>: [<span class=\"string\">\"ESNext\"</span>, <span class=\"string\">\"DOM\"</span>],</span><br><span class=\"line\">    <span class=\"attr\">\"allowSyntheticDefaultImports\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"paths\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"@packages/*\"</span>: [<span class=\"string\">\"packages/*\"</span>],</span><br><span class=\"line\">      <span class=\"attr\">\"@website/*\"</span>: [<span class=\"string\">\"website/*\"</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"exclude\"</span>: [<span class=\"string\">\"node_modules\"</span>, <span class=\"string\">\"lib\"</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<h3 id=\"添加-ts-声明文件\"><a href=\"#添加-ts-声明文件\" class=\"headerlink\" title=\"添加 ts 声明文件\"></a>添加 ts 声明文件</h3><p>根目录新建<code>types</code>文件夹，ts 的所有声明放在这里。目前只新增<code>shims-vue.d.ts</code></p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">TYPESCRIPT</span></header><figure class=\"iseeu highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">declare</span> <span class=\"keyword\">module</span> '*.vue' &#123;</span><br><span class=\"line\">  <span class=\"keyword\">import</span> &#123; defineComponent &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> Component: ReturnType&lt;<span class=\"keyword\">typeof</span> defineComponent&gt;</span><br><span class=\"line\">  <span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Component</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<h3 id=\"修改对应-js-文件为-ts-文件-css改为-scss\"><a href=\"#修改对应-js-文件为-ts-文件-css改为-scss\" class=\"headerlink\" title=\"修改对应 js 文件为 ts 文件, css改为 scss\"></a>修改对应 js 文件为 ts 文件, css改为 scss</h3><p>把 <code>packages</code>对应包的 js文件和<code>website</code>下的<code>index.js</code>全部改为 ts 结尾；所有 vue 组件的 <code>script</code> 增加<code>lang=“ts”</code>，<code>style</code>增加<code>lang=”scss“</code></p>\n<h3 id=\"修改-webpack-配置\"><a href=\"#修改-webpack-配置\" class=\"headerlink\" title=\"修改 webpack 配置\"></a>修改 webpack 配置</h3><p>增加 ts-loader 和 sass-loader配置；修改入口文件为 ts 结尾；添加<code>resolve.extensions</code>，支持 ts 文件引用</p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">DIFF</span></header><figure class=\"iseeu highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// build/webpack.config.base.js</span><br><span class=\"line\">'use strict'</span><br><span class=\"line\">const HtmlWebpackPlugin = require('html-webpack-plugin')</span><br><span class=\"line\">const &#123; VueLoaderPlugin &#125; = require('vue-loader')</span><br><span class=\"line\">const path = require('path')</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\"><span class=\"deletion\">-  entry: path.resolve(__dirname, '../website/index.js'),</span></span><br><span class=\"line\"><span class=\"addition\">+  entry: path.resolve(__dirname, '../website/index.ts'),</span></span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: path.resolve(__dirname, '../dist'),</span><br><span class=\"line\">    filename: 'index.js'</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"><span class=\"addition\">+  resolve: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    alias: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      '@package': path.resolve(__dirname, '../packages'),</span></span><br><span class=\"line\"><span class=\"addition\">+      '@website': path.resolve(__dirname, '../website')</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+    extensions: ['.ts', '.js', '.json']</span></span><br><span class=\"line\"><span class=\"addition\">+  &#125;,</span></span><br><span class=\"line\">  module: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.js$/,</span><br><span class=\"line\">        loader: 'babel-loader',</span><br><span class=\"line\">        exclude: /node_modules/</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.vue$/,</span><br><span class=\"line\">        loader: 'vue-loader'</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\"><span class=\"addition\">+      &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        test: /\\.scss$/,</span></span><br><span class=\"line\"><span class=\"addition\">+        use: [</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123; loader: 'style-loader' &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'css-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+            options: &#123; sourceMap: true &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'sass-loader'</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+        ]</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+      &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        test: /\\.tsx?$/,</span></span><br><span class=\"line\"><span class=\"addition\">+        use: [</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'babel-loader'</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'ts-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+            options: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+              transpileOnly: true</span></span><br><span class=\"line\"><span class=\"addition\">+            &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+        ],</span></span><br><span class=\"line\"><span class=\"addition\">+        exclude: /node_modules/</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      template: './website/index.html',</span><br><span class=\"line\">      filename: './index.html'</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    new VueLoaderPlugin()</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// build/webpack.config.build.js</span><br><span class=\"line\">'use strict'</span><br><span class=\"line\">const path = require('path')</span><br><span class=\"line\">const &#123; VueLoaderPlugin &#125; = require('vue-loader')</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">  mode: 'production',</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\"><span class=\"deletion\">-    adminUI: './packages/admin-ui/index.js'</span></span><br><span class=\"line\"><span class=\"addition\">+    adminUI: './packages/admin-ui/index.ts'</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: path.resolve(__dirname, '../lib'), // 出口目录</span><br><span class=\"line\">    publicPath: '/lib/',</span><br><span class=\"line\">    library: 'adminUI', // 包名</span><br><span class=\"line\">    filename: 'index.js',</span><br><span class=\"line\">    libraryTarget: 'umd',</span><br><span class=\"line\">    umdNamedDefine: true // 会对 UMD 的构建过程中的 AMD 模块进行命名。否则就使用匿名的 define</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"><span class=\"addition\">+  resolve: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    alias: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      '@package': path.resolve(__dirname, '../packages'),</span></span><br><span class=\"line\"><span class=\"addition\">+      '@website': path.resolve(__dirname, '../website')</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+    extensions: ['.ts', '.js', '.json']</span></span><br><span class=\"line\"><span class=\"addition\">+  &#125;,</span></span><br><span class=\"line\">  externals: &#123;</span><br><span class=\"line\">    vue: &#123;</span><br><span class=\"line\">      root: 'Vue',</span><br><span class=\"line\">      commonjs: 'vue',</span><br><span class=\"line\">      commonjs2: 'vue',</span><br><span class=\"line\">      amd: 'vue'</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  optimization: &#123;</span><br><span class=\"line\">    splitChunks: &#123;</span><br><span class=\"line\">      cacheGroups: &#123;</span><br><span class=\"line\">        commons: &#123;</span><br><span class=\"line\">          test: /[\\\\/]node_modules[\\\\/]/,</span><br><span class=\"line\">          name: 'vendor',</span><br><span class=\"line\">          chunks: 'all'</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  module: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.js$/,</span><br><span class=\"line\">        loader: 'babel-loader',</span><br><span class=\"line\">        exclude: /node_modules/</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.vue$/,</span><br><span class=\"line\">        loader: 'vue-loader'</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\"><span class=\"addition\">+      &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        test: /\\.scss$/,</span></span><br><span class=\"line\"><span class=\"addition\">+        use: [</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123; loader: 'style-loader' &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'css-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+            options: &#123; sourceMap: true &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'sass-loader'</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+        ]</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+      &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        test: /\\.tsx?$/,</span></span><br><span class=\"line\"><span class=\"addition\">+        use: [</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'babel-loader'</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'ts-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+            options: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+              transpileOnly: true</span></span><br><span class=\"line\"><span class=\"addition\">+            &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+        ],</span></span><br><span class=\"line\"><span class=\"addition\">+        exclude: /node_modules/</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [new VueLoaderPlugin()]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n","more":"<h2 id=\"加入-typescript-sass\"><a href=\"#加入-typescript-sass\" class=\"headerlink\" title=\"加入 typescript/sass\"></a>加入 typescript/sass</h2><h3 id=\"添加-typescript、ts-loader、sass、sass-loader\"><a href=\"#添加-typescript、ts-loader、sass、sass-loader\" class=\"headerlink\" title=\"添加 typescript、ts-loader、sass、sass-loader\"></a>添加 typescript、ts-loader、sass、sass-loader</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add -D typescript ts-loader sass sass-loader -W</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><a href=\"mailto:ts-loader@8.1.0\" target=\"_blank\" rel=\"noopener\">ts-loader@8.1.0</a> 报错，这里选择了 v8.0.3; <a href=\"mailto:sass-loader@11.0.1\" target=\"_blank\" rel=\"noopener\">sass-loader@11.0.1</a>报错，选择了 v10.1.1,如果你的 loader 运行没有报错可以忽略。</p>\n</blockquote>\n<h3 id=\"添加-tsconfig-json\"><a href=\"#添加-tsconfig-json\" class=\"headerlink\" title=\"添加 tsconfig.json\"></a>添加 tsconfig.json</h3><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"compilerOptions\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"module\"</span>: <span class=\"string\">\"ESNext\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"declaration\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"noImplicitAny\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"removeComments\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"moduleResolution\"</span>: <span class=\"string\">\"node\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"esModuleInterop\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"jsx\"</span>: <span class=\"string\">\"preserve\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"noLib\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"target\"</span>: <span class=\"string\">\"es6\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"baseUrl\"</span>: <span class=\"string\">\".\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"sourceMap\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"lib\"</span>: [<span class=\"string\">\"ESNext\"</span>, <span class=\"string\">\"DOM\"</span>],</span><br><span class=\"line\">    <span class=\"attr\">\"allowSyntheticDefaultImports\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"paths\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"@packages/*\"</span>: [<span class=\"string\">\"packages/*\"</span>],</span><br><span class=\"line\">      <span class=\"attr\">\"@website/*\"</span>: [<span class=\"string\">\"website/*\"</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"exclude\"</span>: [<span class=\"string\">\"node_modules\"</span>, <span class=\"string\">\"lib\"</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"添加-ts-声明文件\"><a href=\"#添加-ts-声明文件\" class=\"headerlink\" title=\"添加 ts 声明文件\"></a>添加 ts 声明文件</h3><p>根目录新建<code>types</code>文件夹，ts 的所有声明放在这里。目前只新增<code>shims-vue.d.ts</code></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">declare</span> <span class=\"keyword\">module</span> '*.vue' &#123;</span><br><span class=\"line\">  <span class=\"keyword\">import</span> &#123; defineComponent &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> Component: ReturnType&lt;<span class=\"keyword\">typeof</span> defineComponent&gt;</span><br><span class=\"line\">  <span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Component</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"修改对应-js-文件为-ts-文件-css改为-scss\"><a href=\"#修改对应-js-文件为-ts-文件-css改为-scss\" class=\"headerlink\" title=\"修改对应 js 文件为 ts 文件, css改为 scss\"></a>修改对应 js 文件为 ts 文件, css改为 scss</h3><p>把 <code>packages</code>对应包的 js文件和<code>website</code>下的<code>index.js</code>全部改为 ts 结尾；所有 vue 组件的 <code>script</code> 增加<code>lang=“ts”</code>，<code>style</code>增加<code>lang=”scss“</code></p>\n<h3 id=\"修改-webpack-配置\"><a href=\"#修改-webpack-配置\" class=\"headerlink\" title=\"修改 webpack 配置\"></a>修改 webpack 配置</h3><p>增加 ts-loader 和 sass-loader配置；修改入口文件为 ts 结尾；添加<code>resolve.extensions</code>，支持 ts 文件引用</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// build/webpack.config.base.js</span><br><span class=\"line\">'use strict'</span><br><span class=\"line\">const HtmlWebpackPlugin = require('html-webpack-plugin')</span><br><span class=\"line\">const &#123; VueLoaderPlugin &#125; = require('vue-loader')</span><br><span class=\"line\">const path = require('path')</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\"><span class=\"deletion\">-  entry: path.resolve(__dirname, '../website/index.js'),</span></span><br><span class=\"line\"><span class=\"addition\">+  entry: path.resolve(__dirname, '../website/index.ts'),</span></span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: path.resolve(__dirname, '../dist'),</span><br><span class=\"line\">    filename: 'index.js'</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"><span class=\"addition\">+  resolve: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    alias: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      '@package': path.resolve(__dirname, '../packages'),</span></span><br><span class=\"line\"><span class=\"addition\">+      '@website': path.resolve(__dirname, '../website')</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+    extensions: ['.ts', '.js', '.json']</span></span><br><span class=\"line\"><span class=\"addition\">+  &#125;,</span></span><br><span class=\"line\">  module: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.js$/,</span><br><span class=\"line\">        loader: 'babel-loader',</span><br><span class=\"line\">        exclude: /node_modules/</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.vue$/,</span><br><span class=\"line\">        loader: 'vue-loader'</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\"><span class=\"addition\">+      &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        test: /\\.scss$/,</span></span><br><span class=\"line\"><span class=\"addition\">+        use: [</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123; loader: 'style-loader' &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'css-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+            options: &#123; sourceMap: true &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'sass-loader'</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+        ]</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+      &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        test: /\\.tsx?$/,</span></span><br><span class=\"line\"><span class=\"addition\">+        use: [</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'babel-loader'</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'ts-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+            options: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+              transpileOnly: true</span></span><br><span class=\"line\"><span class=\"addition\">+            &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+        ],</span></span><br><span class=\"line\"><span class=\"addition\">+        exclude: /node_modules/</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      template: './website/index.html',</span><br><span class=\"line\">      filename: './index.html'</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    new VueLoaderPlugin()</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// build/webpack.config.build.js</span><br><span class=\"line\">'use strict'</span><br><span class=\"line\">const path = require('path')</span><br><span class=\"line\">const &#123; VueLoaderPlugin &#125; = require('vue-loader')</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">  mode: 'production',</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\"><span class=\"deletion\">-    adminUI: './packages/admin-ui/index.js'</span></span><br><span class=\"line\"><span class=\"addition\">+    adminUI: './packages/admin-ui/index.ts'</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: path.resolve(__dirname, '../lib'), // 出口目录</span><br><span class=\"line\">    publicPath: '/lib/',</span><br><span class=\"line\">    library: 'adminUI', // 包名</span><br><span class=\"line\">    filename: 'index.js',</span><br><span class=\"line\">    libraryTarget: 'umd',</span><br><span class=\"line\">    umdNamedDefine: true // 会对 UMD 的构建过程中的 AMD 模块进行命名。否则就使用匿名的 define</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"><span class=\"addition\">+  resolve: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    alias: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      '@package': path.resolve(__dirname, '../packages'),</span></span><br><span class=\"line\"><span class=\"addition\">+      '@website': path.resolve(__dirname, '../website')</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+    extensions: ['.ts', '.js', '.json']</span></span><br><span class=\"line\"><span class=\"addition\">+  &#125;,</span></span><br><span class=\"line\">  externals: &#123;</span><br><span class=\"line\">    vue: &#123;</span><br><span class=\"line\">      root: 'Vue',</span><br><span class=\"line\">      commonjs: 'vue',</span><br><span class=\"line\">      commonjs2: 'vue',</span><br><span class=\"line\">      amd: 'vue'</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  optimization: &#123;</span><br><span class=\"line\">    splitChunks: &#123;</span><br><span class=\"line\">      cacheGroups: &#123;</span><br><span class=\"line\">        commons: &#123;</span><br><span class=\"line\">          test: /[\\\\/]node_modules[\\\\/]/,</span><br><span class=\"line\">          name: 'vendor',</span><br><span class=\"line\">          chunks: 'all'</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  module: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.js$/,</span><br><span class=\"line\">        loader: 'babel-loader',</span><br><span class=\"line\">        exclude: /node_modules/</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.vue$/,</span><br><span class=\"line\">        loader: 'vue-loader'</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\"><span class=\"addition\">+      &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        test: /\\.scss$/,</span></span><br><span class=\"line\"><span class=\"addition\">+        use: [</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123; loader: 'style-loader' &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'css-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+            options: &#123; sourceMap: true &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'sass-loader'</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+        ]</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+      &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        test: /\\.tsx?$/,</span></span><br><span class=\"line\"><span class=\"addition\">+        use: [</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'babel-loader'</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'ts-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+            options: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+              transpileOnly: true</span></span><br><span class=\"line\"><span class=\"addition\">+            &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+        ],</span></span><br><span class=\"line\"><span class=\"addition\">+        exclude: /node_modules/</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [new VueLoaderPlugin()]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":[{"name":"adminUI","path":"api/categories/adminUI.json"}],"tags":[{"name":"vue","path":"api/tags/vue.json"},{"name":"adminUI","path":"api/tags/adminUI.json"}]}