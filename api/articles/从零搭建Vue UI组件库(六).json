{"title":"从零搭建Vue UI组件库(六)","slug":"从零搭建Vue UI组件库(六)","date":"2021-04-26T02:42:23.000Z","updated":"2023-06-21T08:55:09.215Z","comments":true,"path":"api/articles/从零搭建Vue UI组件库(六).json","excerpt":null,"covers":null,"content":"<p>上一步中,已经实现了本地开发 + 应用打包的全部流程, 开发 UI 框架的这套框架本身就已经完成了。现在只需要打包上传到 npm, 框架本身也完成了。剩下的就只是不断完善组件了。</p>\n<h2 id=\"生成打包\"><a href=\"#生成打包\" class=\"headerlink\" title=\"生成打包\"></a>生成打包</h2><p>修改<code>package.json</code>，添加入口文件</p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"><span>package.json</span></span><span class=\"mac-panel__language\">DIFF</span></header><figure class=\"iseeu highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"addition\">+  \"main\": \"lib/index.js\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<h2 id=\"本地测试\"><a href=\"#本地测试\" class=\"headerlink\" title=\"本地测试\"></a>本地测试</h2><p>执行<code>npm pack</code>，生成一个本地的<code>zcm-admin-ui-0.0.0.tgz</code>包，这个包可以本地安装，用来预览结果</p>\n<p>执行<code>yarn add ./zcm-admin-ui-0.0.0.tgz</code>，本地安装这个包，安装结束后会发现依赖选项里安装了这个包，但是路径是在<code>./</code>下。这个时候<code>main.ts</code>中就已经可以使用 <code>import AdminUI from &#39;zcm-admin-ui&#39;</code>了。<strong>记得测试完成后，删除这一测试选项，开发环境还是用 @packages 里的包，保证开发时候方便</strong></p>\n<h3 id=\"修改main-ts\"><a href=\"#修改main-ts\" class=\"headerlink\" title=\"修改main.ts\"></a>修改<code>main.ts</code></h3><div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">JS</span></header><figure class=\"iseeu highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createApp &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> App <span class=\"keyword\">from</span> <span class=\"string\">'./app.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> router <span class=\"keyword\">from</span> <span class=\"string\">'./router'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> i18n <span class=\"keyword\">from</span> <span class=\"string\">'./locales/index'</span></span><br><span class=\"line\"><span class=\"comment\">// admin-ui</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> AdminUI <span class=\"keyword\">from</span> <span class=\"string\">'zcm-admin-ui'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'zcm-admin-ui/lib/theme/index.css'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// components</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> DemoBlock <span class=\"keyword\">from</span> <span class=\"string\">'./components/DemoBlock/index.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> DtIcon <span class=\"keyword\">from</span> <span class=\"string\">'@packages/icon'</span></span><br><span class=\"line\"><span class=\"comment\">// reset-css</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'highlight.js/styles/color-brewer.css'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./styles/common.scss'</span></span><br><span class=\"line\"></span><br><span class=\"line\">createApp(App)</span><br><span class=\"line\">  .use(AdminUI)</span><br><span class=\"line\">  .use(i18n)</span><br><span class=\"line\">  .component(<span class=\"string\">'demo-block'</span>, DemoBlock)</span><br><span class=\"line\">  .component(<span class=\"string\">'dt-icon'</span>, DtIcon)</span><br><span class=\"line\">  .use(router)</span><br><span class=\"line\">  .mount(<span class=\"string\">'#app'</span>)</span><br></pre></td></tr></table></figure></div>\n<p>如果修改之后，和之前一样正常使用，说明没有问题，可以打包上传。</p>\n<blockquote>\n<p>上传之前先删除上一步的 tgz 包，它已经没用了</p>\n</blockquote>\n<h2 id=\"发布-npm\"><a href=\"#发布-npm\" class=\"headerlink\" title=\"发布 npm\"></a>发布 npm</h2><p>首先要有账号，到 npm 官网注册即可</p>\n<p>执行<code>npm login</code>，按照要求依次填写账号、密码、邮箱。出现<code>logged in as xxx on http://registry.npmjs.org</code>，说明登录成功了</p>\n<p>然后在项目根目录执行<code>npm publish</code>，就可以了</p>\n<h2 id=\"常见问题\"><a href=\"#常见问题\" class=\"headerlink\" title=\"常见问题\"></a>常见问题</h2><ul>\n<li>项目是用<code>lerna</code>初始化的，<code>package.json</code>里<code>private</code>选项必须是<code>true</code>才行，但是上传 npm 又要求必须是<code>false</code>，暂时不知道为什么，怎么处理</li>\n<li><p>发布报错<code>npm ERR! no_perms Private mode enable, only admin can publish this module</code>，是因为使用了淘宝镜像，需要重置到原本的 npm 地址</p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">SHELL</span></header><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config set registry=http://registry.npmjs.org</span><br></pre></td></tr></table></figure></div>\n</li>\n<li><p>每次发布需要修改版本号（package.json的 version），否则会提交失败。详见<a href=\"https://www.jianshu.com/p/7d83bda6d751\" target=\"_blank\" rel=\"noopener\">npm 版本号规则</a></p>\n</li>\n</ul>\n<h2 id=\"完\"><a href=\"#完\" class=\"headerlink\" title=\"完\"></a>完</h2><p>组件方面，我也有打算一直维护，并且不参考任何框架，有时间就按自己的想法去尝试一下。</p>\n<p>最后再附上<a href=\"https://github.com/lost-dream/zcm-admin-ui\" target=\"_blank\" rel=\"noopener\">本项目仓库地址</a>，希望有幸看到这篇文章你也能有所收获</p>\n","more":"<p>上一步中,已经实现了本地开发 + 应用打包的全部流程, 开发 UI 框架的这套框架本身就已经完成了。现在只需要打包上传到 npm, 框架本身也完成了。剩下的就只是不断完善组件了。</p>\n<h2 id=\"生成打包\"><a href=\"#生成打包\" class=\"headerlink\" title=\"生成打包\"></a>生成打包</h2><p>修改<code>package.json</code>，添加入口文件</p>\n<figure class=\"highlight diff\"><figcaption><span>package.json</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"addition\">+  \"main\": \"lib/index.js\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"本地测试\"><a href=\"#本地测试\" class=\"headerlink\" title=\"本地测试\"></a>本地测试</h2><p>执行<code>npm pack</code>，生成一个本地的<code>zcm-admin-ui-0.0.0.tgz</code>包，这个包可以本地安装，用来预览结果</p>\n<p>执行<code>yarn add ./zcm-admin-ui-0.0.0.tgz</code>，本地安装这个包，安装结束后会发现依赖选项里安装了这个包，但是路径是在<code>./</code>下。这个时候<code>main.ts</code>中就已经可以使用 <code>import AdminUI from &#39;zcm-admin-ui&#39;</code>了。<strong>记得测试完成后，删除这一测试选项，开发环境还是用 @packages 里的包，保证开发时候方便</strong></p>\n<h3 id=\"修改main-ts\"><a href=\"#修改main-ts\" class=\"headerlink\" title=\"修改main.ts\"></a>修改<code>main.ts</code></h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createApp &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> App <span class=\"keyword\">from</span> <span class=\"string\">'./app.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> router <span class=\"keyword\">from</span> <span class=\"string\">'./router'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> i18n <span class=\"keyword\">from</span> <span class=\"string\">'./locales/index'</span></span><br><span class=\"line\"><span class=\"comment\">// admin-ui</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> AdminUI <span class=\"keyword\">from</span> <span class=\"string\">'zcm-admin-ui'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'zcm-admin-ui/lib/theme/index.css'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// components</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> DemoBlock <span class=\"keyword\">from</span> <span class=\"string\">'./components/DemoBlock/index.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> DtIcon <span class=\"keyword\">from</span> <span class=\"string\">'@packages/icon'</span></span><br><span class=\"line\"><span class=\"comment\">// reset-css</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'highlight.js/styles/color-brewer.css'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./styles/common.scss'</span></span><br><span class=\"line\"></span><br><span class=\"line\">createApp(App)</span><br><span class=\"line\">  .use(AdminUI)</span><br><span class=\"line\">  .use(i18n)</span><br><span class=\"line\">  .component(<span class=\"string\">'demo-block'</span>, DemoBlock)</span><br><span class=\"line\">  .component(<span class=\"string\">'dt-icon'</span>, DtIcon)</span><br><span class=\"line\">  .use(router)</span><br><span class=\"line\">  .mount(<span class=\"string\">'#app'</span>)</span><br></pre></td></tr></table></figure>\n<p>如果修改之后，和之前一样正常使用，说明没有问题，可以打包上传。</p>\n<blockquote>\n<p>上传之前先删除上一步的 tgz 包，它已经没用了</p>\n</blockquote>\n<h2 id=\"发布-npm\"><a href=\"#发布-npm\" class=\"headerlink\" title=\"发布 npm\"></a>发布 npm</h2><p>首先要有账号，到 npm 官网注册即可</p>\n<p>执行<code>npm login</code>，按照要求依次填写账号、密码、邮箱。出现<code>logged in as xxx on http://registry.npmjs.org</code>，说明登录成功了</p>\n<p>然后在项目根目录执行<code>npm publish</code>，就可以了</p>\n<h2 id=\"常见问题\"><a href=\"#常见问题\" class=\"headerlink\" title=\"常见问题\"></a>常见问题</h2><ul>\n<li>项目是用<code>lerna</code>初始化的，<code>package.json</code>里<code>private</code>选项必须是<code>true</code>才行，但是上传 npm 又要求必须是<code>false</code>，暂时不知道为什么，怎么处理</li>\n<li><p>发布报错<code>npm ERR! no_perms Private mode enable, only admin can publish this module</code>，是因为使用了淘宝镜像，需要重置到原本的 npm 地址</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config set registry=http://registry.npmjs.org</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>每次发布需要修改版本号（package.json的 version），否则会提交失败。详见<a href=\"https://www.jianshu.com/p/7d83bda6d751\" target=\"_blank\" rel=\"noopener\">npm 版本号规则</a></p>\n</li>\n</ul>\n<h2 id=\"完\"><a href=\"#完\" class=\"headerlink\" title=\"完\"></a>完</h2><p>组件方面，我也有打算一直维护，并且不参考任何框架，有时间就按自己的想法去尝试一下。</p>\n<p>最后再附上<a href=\"https://github.com/lost-dream/zcm-admin-ui\" target=\"_blank\" rel=\"noopener\">本项目仓库地址</a>，希望有幸看到这篇文章你也能有所收获</p>\n","categories":[{"name":"adminUI","path":"api/categories/adminUI.json"}],"tags":[{"name":"vue","path":"api/tags/vue.json"},{"name":"adminUI","path":"api/tags/adminUI.json"}]}