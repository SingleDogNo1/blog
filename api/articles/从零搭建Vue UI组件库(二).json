{"title":"从零搭建Vue UI组件库(二)","slug":"从零搭建Vue UI组件库(二)","date":"2021-04-15T03:17:57.000Z","updated":"2023-06-21T08:55:09.214Z","comments":true,"path":"api/articles/从零搭建Vue UI组件库(二).json","excerpt":null,"covers":null,"content":"<p>上一篇结束，使用 webpack 搭建了一个本地服务，事实上还不算项目模板，这篇的目的是编写一个基础的 HelloWorld 组件</p>\n<h2 id=\"创建组件\"><a href=\"#创建组件\" class=\"headerlink\" title=\"创建组件\"></a>创建组件</h2><p>在 <code>packages/hello</code>中新建<code>src</code>文件夹，存放 vue 源文件，新建 <code>index.js</code>用来暴露和挂载组件</p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">JAVASCRIPT</span></header><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/index.vue</span></span><br><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;h2&gt;Hello, &#123;&#123; name &#125;&#125; !&lt;<span class=\"regexp\">/h2&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;/</span>div&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/template&gt;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">&lt;script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  import &#123; defineComponent &#125; from 'vue'</span></span><br><span class=\"line\"><span class=\"regexp\">  export default defineComponent(&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    name: 'Hello',</span></span><br><span class=\"line\"><span class=\"regexp\">    props: &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">      name: &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">        type: String,</span></span><br><span class=\"line\"><span class=\"regexp\">        default: 'admin UI'</span></span><br><span class=\"line\"><span class=\"regexp\">      &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;)</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// index.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Hello <span class=\"keyword\">from</span> <span class=\"string\">'./src/index.vue'</span></span><br><span class=\"line\"><span class=\"comment\">// 关于 vue 插件，不熟悉的可以去看一下 vue 官网</span></span><br><span class=\"line\">Hello.install = <span class=\"function\"><span class=\"params\">app</span> =&gt;</span> &#123;</span><br><span class=\"line\">  app.component(Hello.name, Hello)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Hello</span><br></pre></td></tr></table></figure></div>\n<p>然后在<code>website</code>文件中引用组件，查看效果</p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">JAVASCRIPT</span></header><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"app\"</span>&gt;</span><br><span class=\"line\">    &lt;Hello :name=<span class=\"string\">\"name\"</span>&gt;&lt;<span class=\"regexp\">/Hello&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;/</span>div&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/template&gt;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">&lt;script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  import &#123; defineComponent, reactive, toRefs &#125; from 'vue'</span></span><br><span class=\"line\"><span class=\"regexp\">  import Hello from '../</span>packages/hello<span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">  export default defineComponent(&#123;</span></span><br><span class=\"line\"><span class=\"string\">    name: '</span>app<span class=\"string\">',</span></span><br><span class=\"line\"><span class=\"string\">    components: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      Hello</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    setup(props, ctx) &#123;</span></span><br><span class=\"line\"><span class=\"string\">      const state = reactive(&#123;</span></span><br><span class=\"line\"><span class=\"string\">        name: '</span>admin ui<span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">      &#125;)</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">      return &#123;</span></span><br><span class=\"line\"><span class=\"string\">        ...toRefs(state)</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;)</span></span><br><span class=\"line\"><span class=\"string\">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></div>\n<p>开发阶段，这样可以快速调试组件，确认组件功能完成后，就需要导出组件。可以预见到的是，以后会有很多个组件需要导出，因此需要一个统一的出口。参照 <code>element-plus</code>，把出口文件定义为<code>packages/admin-ui/index.js</code></p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">JAVASCRIPT</span></header><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Hello <span class=\"keyword\">from</span> <span class=\"string\">'../hello'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> components = [Hello]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> install = <span class=\"function\"><span class=\"params\">app</span> =&gt;</span> &#123;</span><br><span class=\"line\">  components.forEach(<span class=\"function\"><span class=\"params\">component</span> =&gt;</span> &#123;</span><br><span class=\"line\">    app.component(component.name, component)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123;</span><br><span class=\"line\">  Hello,</span><br><span class=\"line\">  install</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  install</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<h2 id=\"打包配置\"><a href=\"#打包配置\" class=\"headerlink\" title=\"打包配置\"></a>打包配置</h2><p><code>build</code>文件夹中新增<code>webpack.config.build.js</code></p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">JAVASCRIPT</span></header><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">'use strict'</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; VueLoaderPlugin &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'vue-loader'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  mode: <span class=\"string\">'production'</span>,</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    <span class=\"string\">'adminUI'</span>: <span class=\"string\">'./packages/admin-ui/index.js'</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: path.resolve(__dirname, <span class=\"string\">'../lib'</span>), <span class=\"comment\">// 出口目录</span></span><br><span class=\"line\">    publicPath: <span class=\"string\">'/lib/'</span>,</span><br><span class=\"line\">    library: <span class=\"string\">'adminUI'</span>, <span class=\"comment\">// 包名</span></span><br><span class=\"line\">    filename: <span class=\"string\">'index.js'</span>, <span class=\"comment\">// 文件名</span></span><br><span class=\"line\">    libraryTarget: <span class=\"string\">'umd'</span>,</span><br><span class=\"line\">    umdNamedDefine: <span class=\"literal\">true</span> <span class=\"comment\">// 会对 UMD 的构建过程中的 AMD 模块进行命名。否则就使用匿名的 define</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  externals: &#123;</span><br><span class=\"line\">    vue: &#123;</span><br><span class=\"line\">      root: <span class=\"string\">'Vue'</span>,</span><br><span class=\"line\">      commonjs: <span class=\"string\">'vue'</span>,</span><br><span class=\"line\">      commonjs2: <span class=\"string\">'vue'</span>,</span><br><span class=\"line\">      amd: <span class=\"string\">'vue'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  optimization: &#123;</span><br><span class=\"line\">    splitChunks: &#123;</span><br><span class=\"line\">      cacheGroups: &#123;</span><br><span class=\"line\">        commons: &#123;</span><br><span class=\"line\">          test: <span class=\"regexp\">/[\\\\/]node_modules[\\\\/]/</span>,</span><br><span class=\"line\">          name: <span class=\"string\">'vendor'</span>,</span><br><span class=\"line\">          chunks: <span class=\"string\">'all'</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">        loader: <span class=\"string\">\"babel-loader\"</span>,</span><br><span class=\"line\">        exclude: <span class=\"regexp\">/node_modules/</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.vue$/</span>,</span><br><span class=\"line\">        loader: <span class=\"string\">'vue-loader'</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> VueLoaderPlugin(),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p><code>package.json</code>新增打包命令<code>&quot;build&quot;: &quot;webpack --config build/webpack.config.build.js&quot;</code><br>使用<code>yarn build</code>,会在根目录生成<code>lib</code>文件夹，包含<code>index.js</code>文件，就是我们最后输出的文件</p>\n<h2 id=\"预览\"><a href=\"#预览\" class=\"headerlink\" title=\"预览\"></a>预览</h2><p>本地调用打包后的组件库，查看效果。修改<code>website</code>中的<code>index.js</code></p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">JAVASCRIPT</span></header><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;createApp&#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> App <span class=\"keyword\">from</span> <span class=\"string\">'./index.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> AdminUI <span class=\"keyword\">from</span> <span class=\"string\">'../lib'</span></span><br><span class=\"line\"></span><br><span class=\"line\">createApp(App).use(AdminUI).mount(<span class=\"string\">'#app'</span>)</span><br></pre></td></tr></table></figure></div>\n<p>删除<code>website/index.vue</code>中导入的组件</p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">JAVASCRIPT</span></header><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"app\"</span>&gt;</span><br><span class=\"line\">    &lt;Hello :name=<span class=\"string\">\"name\"</span>&gt;&lt;<span class=\"regexp\">/Hello&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;/</span>div&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/template&gt;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">&lt;script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  import &#123; defineComponent, reactive, toRefs &#125; from 'vue'</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">  export default defineComponent(&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    name: 'app',</span></span><br><span class=\"line\"><span class=\"regexp\">    setup(props, ctx) &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">      const state = reactive(&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">        name: 'admin ui'</span></span><br><span class=\"line\"><span class=\"regexp\">      &#125;)</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">      return &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">        ...toRefs(state)</span></span><br><span class=\"line\"><span class=\"regexp\">      &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;)</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure></div>\n<p>运行项目，会发现结果完全一致。说明组件打包是没有问题的，接下来只要把<code>lib</code>文件夹上传到 npm,就可以像<code>element-ui</code>一样使用啦！</p>\n<h2 id=\"next\"><a href=\"#next\" class=\"headerlink\" title=\"next\"></a>next</h2><p>虽然很简陋，但想要的功能第一步已经实现了，接下来我先不打算上传 npm，我的计划有以下几个：</p>\n<ul>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 增加 eslint/prettier/lint-staged,保证代码结构</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 添加 typescript，使用 ts 开发</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 结合 vuepress,使用 MD 作为文档和展示组件 demo</li>\n</ul>\n","more":"<p>上一篇结束，使用 webpack 搭建了一个本地服务，事实上还不算项目模板，这篇的目的是编写一个基础的 HelloWorld 组件</p>\n<h2 id=\"创建组件\"><a href=\"#创建组件\" class=\"headerlink\" title=\"创建组件\"></a>创建组件</h2><p>在 <code>packages/hello</code>中新建<code>src</code>文件夹，存放 vue 源文件，新建 <code>index.js</code>用来暴露和挂载组件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/index.vue</span></span><br><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;h2&gt;Hello, &#123;&#123; name &#125;&#125; !&lt;<span class=\"regexp\">/h2&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;/</span>div&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/template&gt;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">&lt;script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  import &#123; defineComponent &#125; from 'vue'</span></span><br><span class=\"line\"><span class=\"regexp\">  export default defineComponent(&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    name: 'Hello',</span></span><br><span class=\"line\"><span class=\"regexp\">    props: &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">      name: &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">        type: String,</span></span><br><span class=\"line\"><span class=\"regexp\">        default: 'admin UI'</span></span><br><span class=\"line\"><span class=\"regexp\">      &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;)</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// index.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> Hello <span class=\"keyword\">from</span> <span class=\"string\">'./src/index.vue'</span></span><br><span class=\"line\"><span class=\"comment\">// 关于 vue 插件，不熟悉的可以去看一下 vue 官网</span></span><br><span class=\"line\">Hello.install = <span class=\"function\"><span class=\"params\">app</span> =&gt;</span> &#123;</span><br><span class=\"line\">  app.component(Hello.name, Hello)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Hello</span><br></pre></td></tr></table></figure>\n<p>然后在<code>website</code>文件中引用组件，查看效果</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"app\"</span>&gt;</span><br><span class=\"line\">    &lt;Hello :name=<span class=\"string\">\"name\"</span>&gt;&lt;<span class=\"regexp\">/Hello&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;/</span>div&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/template&gt;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">&lt;script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  import &#123; defineComponent, reactive, toRefs &#125; from 'vue'</span></span><br><span class=\"line\"><span class=\"regexp\">  import Hello from '../</span>packages/hello<span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">  export default defineComponent(&#123;</span></span><br><span class=\"line\"><span class=\"string\">    name: '</span>app<span class=\"string\">',</span></span><br><span class=\"line\"><span class=\"string\">    components: &#123;</span></span><br><span class=\"line\"><span class=\"string\">      Hello</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    setup(props, ctx) &#123;</span></span><br><span class=\"line\"><span class=\"string\">      const state = reactive(&#123;</span></span><br><span class=\"line\"><span class=\"string\">        name: '</span>admin ui<span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">      &#125;)</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">      return &#123;</span></span><br><span class=\"line\"><span class=\"string\">        ...toRefs(state)</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  &#125;)</span></span><br><span class=\"line\"><span class=\"string\">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>\n<p>开发阶段，这样可以快速调试组件，确认组件功能完成后，就需要导出组件。可以预见到的是，以后会有很多个组件需要导出，因此需要一个统一的出口。参照 <code>element-plus</code>，把出口文件定义为<code>packages/admin-ui/index.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Hello <span class=\"keyword\">from</span> <span class=\"string\">'../hello'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> components = [Hello]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> install = <span class=\"function\"><span class=\"params\">app</span> =&gt;</span> &#123;</span><br><span class=\"line\">  components.forEach(<span class=\"function\"><span class=\"params\">component</span> =&gt;</span> &#123;</span><br><span class=\"line\">    app.component(component.name, component)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123;</span><br><span class=\"line\">  Hello,</span><br><span class=\"line\">  install</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  install</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"打包配置\"><a href=\"#打包配置\" class=\"headerlink\" title=\"打包配置\"></a>打包配置</h2><p><code>build</code>文件夹中新增<code>webpack.config.build.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">'use strict'</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; VueLoaderPlugin &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'vue-loader'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  mode: <span class=\"string\">'production'</span>,</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    <span class=\"string\">'adminUI'</span>: <span class=\"string\">'./packages/admin-ui/index.js'</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: path.resolve(__dirname, <span class=\"string\">'../lib'</span>), <span class=\"comment\">// 出口目录</span></span><br><span class=\"line\">    publicPath: <span class=\"string\">'/lib/'</span>,</span><br><span class=\"line\">    library: <span class=\"string\">'adminUI'</span>, <span class=\"comment\">// 包名</span></span><br><span class=\"line\">    filename: <span class=\"string\">'index.js'</span>, <span class=\"comment\">// 文件名</span></span><br><span class=\"line\">    libraryTarget: <span class=\"string\">'umd'</span>,</span><br><span class=\"line\">    umdNamedDefine: <span class=\"literal\">true</span> <span class=\"comment\">// 会对 UMD 的构建过程中的 AMD 模块进行命名。否则就使用匿名的 define</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  externals: &#123;</span><br><span class=\"line\">    vue: &#123;</span><br><span class=\"line\">      root: <span class=\"string\">'Vue'</span>,</span><br><span class=\"line\">      commonjs: <span class=\"string\">'vue'</span>,</span><br><span class=\"line\">      commonjs2: <span class=\"string\">'vue'</span>,</span><br><span class=\"line\">      amd: <span class=\"string\">'vue'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  optimization: &#123;</span><br><span class=\"line\">    splitChunks: &#123;</span><br><span class=\"line\">      cacheGroups: &#123;</span><br><span class=\"line\">        commons: &#123;</span><br><span class=\"line\">          test: <span class=\"regexp\">/[\\\\/]node_modules[\\\\/]/</span>,</span><br><span class=\"line\">          name: <span class=\"string\">'vendor'</span>,</span><br><span class=\"line\">          chunks: <span class=\"string\">'all'</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">        loader: <span class=\"string\">\"babel-loader\"</span>,</span><br><span class=\"line\">        exclude: <span class=\"regexp\">/node_modules/</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.vue$/</span>,</span><br><span class=\"line\">        loader: <span class=\"string\">'vue-loader'</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> VueLoaderPlugin(),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>package.json</code>新增打包命令<code>&quot;build&quot;: &quot;webpack --config build/webpack.config.build.js&quot;</code><br>使用<code>yarn build</code>,会在根目录生成<code>lib</code>文件夹，包含<code>index.js</code>文件，就是我们最后输出的文件</p>\n<h2 id=\"预览\"><a href=\"#预览\" class=\"headerlink\" title=\"预览\"></a>预览</h2><p>本地调用打包后的组件库，查看效果。修改<code>website</code>中的<code>index.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;createApp&#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> App <span class=\"keyword\">from</span> <span class=\"string\">'./index.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> AdminUI <span class=\"keyword\">from</span> <span class=\"string\">'../lib'</span></span><br><span class=\"line\"></span><br><span class=\"line\">createApp(App).use(AdminUI).mount(<span class=\"string\">'#app'</span>)</span><br></pre></td></tr></table></figure>\n<p>删除<code>website/index.vue</code>中导入的组件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"app\"</span>&gt;</span><br><span class=\"line\">    &lt;Hello :name=<span class=\"string\">\"name\"</span>&gt;&lt;<span class=\"regexp\">/Hello&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;/</span>div&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/template&gt;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">&lt;script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  import &#123; defineComponent, reactive, toRefs &#125; from 'vue'</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">  export default defineComponent(&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    name: 'app',</span></span><br><span class=\"line\"><span class=\"regexp\">    setup(props, ctx) &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">      const state = reactive(&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">        name: 'admin ui'</span></span><br><span class=\"line\"><span class=\"regexp\">      &#125;)</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">      return &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">        ...toRefs(state)</span></span><br><span class=\"line\"><span class=\"regexp\">      &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;)</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>\n<p>运行项目，会发现结果完全一致。说明组件打包是没有问题的，接下来只要把<code>lib</code>文件夹上传到 npm,就可以像<code>element-ui</code>一样使用啦！</p>\n<h2 id=\"next\"><a href=\"#next\" class=\"headerlink\" title=\"next\"></a>next</h2><p>虽然很简陋，但想要的功能第一步已经实现了，接下来我先不打算上传 npm，我的计划有以下几个：</p>\n<ul>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 增加 eslint/prettier/lint-staged,保证代码结构</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 添加 typescript，使用 ts 开发</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 结合 vuepress,使用 MD 作为文档和展示组件 demo</li>\n</ul>\n","categories":[{"name":"adminUI","path":"api/categories/adminUI.json"}],"tags":[{"name":"vue","path":"api/tags/vue.json"},{"name":"adminUI","path":"api/tags/adminUI.json"}]}