{"title":"vue3 脚手架（三）","slug":"vite-vue-3","date":"2021-07-05T00:59:14.000Z","updated":"2023-06-21T08:55:09.214Z","comments":true,"path":"api/articles/vite-vue-3.json","excerpt":null,"covers":null,"content":"<blockquote>\n<p>本文仓库地址为: <a href=\"https://github.com/lost-dream/vue3-template\" target=\"_blank\" rel=\"noopener\">vue3-template</a></p>\n</blockquote>\n<p>开发环境和开发工具初步配置完成，开始加入 <code>vite脚手架配置</code> 和 <code>vue全家桶</code></p>\n<blockquote>\n<p>vue3.x 全家桶语法都有些变化，加上我在尝试 <code>composition API</code>语法，也在学习 ts，所以写起来和 vue2.x 会有很大的不同</p>\n</blockquote>\n<h2 id=\"vite-脚手架\"><a href=\"#vite-脚手架\" class=\"headerlink\" title=\"vite 脚手架\"></a>vite 脚手架</h2><p>关于 <code>vite</code> 的脚手架具体配置可以到<a href=\"https://cn.vitejs.dev/config/\" target=\"_blank\" rel=\"noopener\">官方文档</a>查看，我这里只是简单配置了一下，更具体的配置可以写具体业务的时候再添加。</p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"><span>vite.config.js</span></span><span class=\"mac-panel__language\">DIFF</span></header><figure class=\"iseeu highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- import &#123; defineConfig &#125; from 'vite'</span></span><br><span class=\"line\"><span class=\"addition\">+ import &#123; UserConfigExport, ConfigEnv &#125; from 'vite'</span></span><br><span class=\"line\">import vue from '@vitejs/plugin-vue'</span><br><span class=\"line\"><span class=\"addition\">+ import &#123; resolve &#125; from 'path'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"deletion\">- export default defineConfig(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+ export default (&#123; command &#125;: ConfigEnv): UserConfigExport =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+   console.log('command :&gt;&gt; ', command)</span></span><br><span class=\"line\"><span class=\"addition\">+   return &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-   plugins: [vue()]</span></span><br><span class=\"line\"><span class=\"addition\">+   plugins: [vue()],</span></span><br><span class=\"line\"><span class=\"addition\">+   resolve: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     alias: [</span></span><br><span class=\"line\"><span class=\"addition\">+       &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         find: /^@\\//,</span></span><br><span class=\"line\"><span class=\"addition\">+         replacement: resolve(__dirname, 'src') + '/',</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+       &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         find: /^\\/#\\//,</span></span><br><span class=\"line\"><span class=\"addition\">+         replacement: resolve(__dirname, 'types') + '/',</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+     ],</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+ &#125;</span></span><br><span class=\"line\"><span class=\"deletion\">-&#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+&#125;</span></span><br></pre></td></tr></table></figure></div>\n<h2 id=\"vue-router\"><a href=\"#vue-router\" class=\"headerlink\" title=\"vue-router\"></a>vue-router</h2><p>参考官网，安装 <code>vue-router</code></p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"><span>/src/router/index.ts</span></span><span class=\"mac-panel__language\">SHELL</span></header><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add vue-router@4</span><br></pre></td></tr></table></figure></div>\n<p>修改路由文件配置</p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"><span>/src/router/index.ts</span></span><span class=\"mac-panel__language\">TS</span></header><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; App &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; RouteRecordRaw &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue-router'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createRouter, createWebHashHistory &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue-router'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> router = createRouter(&#123;</span><br><span class=\"line\">  history: createWebHashHistory(),</span><br><span class=\"line\">  routes: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">      name: <span class=\"string\">'root'</span>,</span><br><span class=\"line\">      component: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">'@/views/Home/index.vue'</span>),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/about'</span>,</span><br><span class=\"line\">      name: <span class=\"string\">'about'</span>,</span><br><span class=\"line\">      component: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">'@/views/About/index.vue'</span>),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ] <span class=\"keyword\">as</span> RouteRecordRaw[],</span><br><span class=\"line\">  strict: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  scrollBehavior: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> (&#123; left: <span class=\"number\">0</span>, top: <span class=\"number\">0</span> &#125;),</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// config-router</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setupRouter</span>(<span class=\"params\">app: App&lt;Element&gt;</span>) </span>&#123;</span><br><span class=\"line\">  app.use(router)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>在 <code>main.ts</code> 中加入 <code>vue-router</code></p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"><span>/src/main.ts</span></span><span class=\"mac-panel__language\">TS</span></header><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createApp &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> App <span class=\"keyword\">from</span> <span class=\"string\">'./App.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; router, setupRouter &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@/router'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = createApp(App)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bootstrap</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">await</span> setupRouter(app)</span><br><span class=\"line\">  <span class=\"keyword\">await</span> router.isReady()</span><br><span class=\"line\">  app.mount(<span class=\"string\">'#app'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">bootstrap()</span><br></pre></td></tr></table></figure></div>\n<p>修改 <code>app.vue</code>，加入 <code>router-view</code>，创建两个视图<code>Home</code>和<code>About</code>，测试 <code>router</code>是否成功。</p>\n<p><strong>注意: 每一个视图组件都应该遵守以下规范:</strong></p>\n<ul>\n<li>视图组件为文件夹，这样方便管理只属于该模块下的子组件、静态资源、ts 模块等</li>\n<li>命名必须遵循首字母大写</li>\n<li>入口文件必须为 <code>index.vue</code></li>\n</ul>\n<h2 id=\"vuex\"><a href=\"#vuex\" class=\"headerlink\" title=\"vuex\"></a>vuex</h2><p>参考官网，安装 <code>vuex</code></p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">SHELL</span></header><figure class=\"iseeu highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add vuex@next vuex-persistedstate --save</span><br></pre></td></tr></table></figure></div>\n<p>创建 <code>store</code>，并分割成模块，<strong>模块结构应该遵循以下规范:</strong></p>\n<ul>\n<li><code>store</code> 根目录下创建 <code>index.ts</code> 作为出口文件，创建 <code>types.ts</code> 作为根目录的 <code>ts</code> 类型文件。</li>\n<li><code>store</code> 根目录下创建 <code>modules</code> 文件夹， <code>modules</code> 文件夹下创建各自模块的文件，同样的，每个模块下创建 <code>index.ts</code> 作为该模块的出口文件，创建 <code>types.ts</code> 作为该模块的 <code>ts</code> 类型文件。</li>\n</ul>\n<p>以 <code>user</code> 模块举例，此时 <code>store</code> 模块结构为</p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">PLAIN</span></header><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── store</span><br><span class=\"line\">    ├── modules</span><br><span class=\"line\">    │   └── user          用户模块目录</span><br><span class=\"line\">    │       ├── index.ts  用户模块出口文件</span><br><span class=\"line\">    │       └── types.ts  用户模块 ts 类型</span><br><span class=\"line\">    ├── index.ts          vuex 整体出口文件</span><br><span class=\"line\">    └── types.ts          vuex 全局 ts 类型</span><br></pre></td></tr></table></figure></div>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">TS</span></header><figure class=\"iseeu highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// store/modules/user/types.ts</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">interface</span> UserState &#123;</span><br><span class=\"line\">  token?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  name?: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// store/modules/user/index.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Module &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vuex'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> RootState <span class=\"keyword\">from</span> <span class=\"string\">'@/store/types'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> UserState <span class=\"keyword\">from</span> <span class=\"string\">'./types'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> userModule: Module&lt;UserState, RootState&gt; = &#123;</span><br><span class=\"line\">  namespaced: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  state: &#123;</span><br><span class=\"line\">    token: <span class=\"string\">'AUTH_TOKEN_123456'</span>,</span><br><span class=\"line\">    name: <span class=\"string\">'赵晨敏'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  mutations: &#123;</span><br><span class=\"line\">    SET_TOKEN: <span class=\"function\">(<span class=\"params\">state, token</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      state.token = token</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    SET_NAME: <span class=\"function\">(<span class=\"params\">state, name</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      state.name = name</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> userModule</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// store/user/index.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; InjectionKey, App &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createStore, Store, useStore <span class=\"keyword\">as</span> baseUseStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vuex'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; AllState &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./types'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> createPersistedState <span class=\"keyword\">from</span> <span class=\"string\">'vuex-persistedstate'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> user <span class=\"keyword\">from</span> <span class=\"string\">'./modules/user'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> store = createStore&lt;AllState&gt;(&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    createPersistedState(&#123;</span><br><span class=\"line\">      storage: <span class=\"built_in\">window</span>.sessionStorage,</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  modules: &#123;</span><br><span class=\"line\">    user,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> key: InjectionKey&lt;Store&lt;AllState&gt;&gt; = Symbol(<span class=\"string\">'vue-store'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">useStore</span>&lt;<span class=\"title\">T</span> = <span class=\"title\">AllState</span>&gt;(<span class=\"params\"></span>): <span class=\"title\">Store</span>&lt;<span class=\"title\">T</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> baseUseStore&lt;T&gt;(key)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setupStore</span>(<span class=\"params\">app: App&lt;Element&gt;</span>) </span>&#123;</span><br><span class=\"line\">  app.use(store, key)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// store/types.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> UserState <span class=\"keyword\">from</span> <span class=\"string\">'./modules/user/types'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// eslint-disable-next-line @typescript-eslint/no-empty-interface</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">interface</span> RootState &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">interface</span> AllState <span class=\"keyword\">extends</span> RootState &#123;</span><br><span class=\"line\">  user: UserState</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>在 <code>main.ts</code> 中加入 <code>vuex</code></p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">DIFF</span></header><figure class=\"iseeu highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+  import &#123; setupStore &#125; from './store'</span></span><br><span class=\"line\"></span><br><span class=\"line\">async function bootstrap() &#123;</span><br><span class=\"line\"><span class=\"addition\">+  await setupStore(app)</span></span><br><span class=\"line\">  await setupRouter(app)</span><br><span class=\"line\">  await router.isReady()</span><br><span class=\"line\">  app.mount('#app')</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>在 <code>Home/index.vue</code> 中测试是否正确添加</p>\n<div class=\"code-panel__wrapper\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\"><header class=\"mac-panel\"><span class=\"doc-path\"></span><span class=\"mac-panel__language\">HTML</span></header><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"home\"</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; name &#125;&#125; -- &#123;&#123; token &#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">\"changeName('李四')\"</span>&gt;</span>按钮<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"ts\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">import</span> &#123; computed, defineComponent, reactive, toRefs &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">import</span> &#123; useStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@/store'</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> defineComponent(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">  name: <span class=\"string\">'Home'</span>,</span></span><br><span class=\"line\">  setup() &#123;</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> store = useStore()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> state = reactive(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      msg: <span class=\"string\">'hello, home'</span>,</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> name = computed(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> store.state.user.name)</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> token = computed(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> store.state.user.token)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">changeName</span>(<span class=\"params\">name</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      store.commit(<span class=\"string\">'user/SET_NAME'</span>, name)</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\">      ...toRefs(state),</span><br><span class=\"line\">      name,</span><br><span class=\"line\">      token,</span><br><span class=\"line\">      changeName,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n<p>基本功能已经添加完成了，但作为开发模板还缺少 UI 功能，下一篇补充 UI 框架和 css 框架。</p>\n","more":"<blockquote>\n<p>本文仓库地址为: <a href=\"https://github.com/lost-dream/vue3-template\" target=\"_blank\" rel=\"noopener\">vue3-template</a></p>\n</blockquote>\n<p>开发环境和开发工具初步配置完成，开始加入 <code>vite脚手架配置</code> 和 <code>vue全家桶</code></p>\n<blockquote>\n<p>vue3.x 全家桶语法都有些变化，加上我在尝试 <code>composition API</code>语法，也在学习 ts，所以写起来和 vue2.x 会有很大的不同</p>\n</blockquote>\n<h2 id=\"vite-脚手架\"><a href=\"#vite-脚手架\" class=\"headerlink\" title=\"vite 脚手架\"></a>vite 脚手架</h2><p>关于 <code>vite</code> 的脚手架具体配置可以到<a href=\"https://cn.vitejs.dev/config/\" target=\"_blank\" rel=\"noopener\">官方文档</a>查看，我这里只是简单配置了一下，更具体的配置可以写具体业务的时候再添加。</p>\n<figure class=\"highlight diff\"><figcaption><span>vite.config.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- import &#123; defineConfig &#125; from 'vite'</span></span><br><span class=\"line\"><span class=\"addition\">+ import &#123; UserConfigExport, ConfigEnv &#125; from 'vite'</span></span><br><span class=\"line\">import vue from '@vitejs/plugin-vue'</span><br><span class=\"line\"><span class=\"addition\">+ import &#123; resolve &#125; from 'path'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"deletion\">- export default defineConfig(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+ export default (&#123; command &#125;: ConfigEnv): UserConfigExport =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+   console.log('command :&gt;&gt; ', command)</span></span><br><span class=\"line\"><span class=\"addition\">+   return &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-   plugins: [vue()]</span></span><br><span class=\"line\"><span class=\"addition\">+   plugins: [vue()],</span></span><br><span class=\"line\"><span class=\"addition\">+   resolve: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     alias: [</span></span><br><span class=\"line\"><span class=\"addition\">+       &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         find: /^@\\//,</span></span><br><span class=\"line\"><span class=\"addition\">+         replacement: resolve(__dirname, 'src') + '/',</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+       &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         find: /^\\/#\\//,</span></span><br><span class=\"line\"><span class=\"addition\">+         replacement: resolve(__dirname, 'types') + '/',</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+     ],</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+ &#125;</span></span><br><span class=\"line\"><span class=\"deletion\">-&#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+&#125;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"vue-router\"><a href=\"#vue-router\" class=\"headerlink\" title=\"vue-router\"></a>vue-router</h2><p>参考官网，安装 <code>vue-router</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add vue-router@4</span><br></pre></td></tr></table></figure>\n<p>修改路由文件配置</p>\n<figure class=\"highlight ts\"><figcaption><span>/src/router/index.ts</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; App &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; RouteRecordRaw &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue-router'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createRouter, createWebHashHistory &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue-router'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> router = createRouter(&#123;</span><br><span class=\"line\">  history: createWebHashHistory(),</span><br><span class=\"line\">  routes: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">      name: <span class=\"string\">'root'</span>,</span><br><span class=\"line\">      component: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">'@/views/Home/index.vue'</span>),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/about'</span>,</span><br><span class=\"line\">      name: <span class=\"string\">'about'</span>,</span><br><span class=\"line\">      component: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">'@/views/About/index.vue'</span>),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ] <span class=\"keyword\">as</span> RouteRecordRaw[],</span><br><span class=\"line\">  strict: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  scrollBehavior: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> (&#123; left: <span class=\"number\">0</span>, top: <span class=\"number\">0</span> &#125;),</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// config-router</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setupRouter</span>(<span class=\"params\">app: App&lt;Element&gt;</span>) </span>&#123;</span><br><span class=\"line\">  app.use(router)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在 <code>main.ts</code> 中加入 <code>vue-router</code></p>\n<figure class=\"highlight ts\"><figcaption><span>/src/main.ts</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createApp &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> App <span class=\"keyword\">from</span> <span class=\"string\">'./App.vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; router, setupRouter &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@/router'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = createApp(App)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bootstrap</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">await</span> setupRouter(app)</span><br><span class=\"line\">  <span class=\"keyword\">await</span> router.isReady()</span><br><span class=\"line\">  app.mount(<span class=\"string\">'#app'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">bootstrap()</span><br></pre></td></tr></table></figure>\n<p>修改 <code>app.vue</code>，加入 <code>router-view</code>，创建两个视图<code>Home</code>和<code>About</code>，测试 <code>router</code>是否成功。</p>\n<p><strong>注意: 每一个视图组件都应该遵守以下规范:</strong></p>\n<ul>\n<li>视图组件为文件夹，这样方便管理只属于该模块下的子组件、静态资源、ts 模块等</li>\n<li>命名必须遵循首字母大写</li>\n<li>入口文件必须为 <code>index.vue</code></li>\n</ul>\n<h2 id=\"vuex\"><a href=\"#vuex\" class=\"headerlink\" title=\"vuex\"></a>vuex</h2><p>参考官网，安装 <code>vuex</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add vuex@next vuex-persistedstate --save</span><br></pre></td></tr></table></figure>\n<p>创建 <code>store</code>，并分割成模块，<strong>模块结构应该遵循以下规范:</strong></p>\n<ul>\n<li><code>store</code> 根目录下创建 <code>index.ts</code> 作为出口文件，创建 <code>types.ts</code> 作为根目录的 <code>ts</code> 类型文件。</li>\n<li><code>store</code> 根目录下创建 <code>modules</code> 文件夹， <code>modules</code> 文件夹下创建各自模块的文件，同样的，每个模块下创建 <code>index.ts</code> 作为该模块的出口文件，创建 <code>types.ts</code> 作为该模块的 <code>ts</code> 类型文件。</li>\n</ul>\n<p>以 <code>user</code> 模块举例，此时 <code>store</code> 模块结构为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── store</span><br><span class=\"line\">    ├── modules</span><br><span class=\"line\">    │   └── user          用户模块目录</span><br><span class=\"line\">    │       ├── index.ts  用户模块出口文件</span><br><span class=\"line\">    │       └── types.ts  用户模块 ts 类型</span><br><span class=\"line\">    ├── index.ts          vuex 整体出口文件</span><br><span class=\"line\">    └── types.ts          vuex 全局 ts 类型</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// store/modules/user/types.ts</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">interface</span> UserState &#123;</span><br><span class=\"line\">  token?: <span class=\"built_in\">string</span></span><br><span class=\"line\">  name?: <span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// store/modules/user/index.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Module &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vuex'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> RootState <span class=\"keyword\">from</span> <span class=\"string\">'@/store/types'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> UserState <span class=\"keyword\">from</span> <span class=\"string\">'./types'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> userModule: Module&lt;UserState, RootState&gt; = &#123;</span><br><span class=\"line\">  namespaced: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  state: &#123;</span><br><span class=\"line\">    token: <span class=\"string\">'AUTH_TOKEN_123456'</span>,</span><br><span class=\"line\">    name: <span class=\"string\">'赵晨敏'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  mutations: &#123;</span><br><span class=\"line\">    SET_TOKEN: <span class=\"function\">(<span class=\"params\">state, token</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      state.token = token</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    SET_NAME: <span class=\"function\">(<span class=\"params\">state, name</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      state.name = name</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> userModule</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// store/user/index.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; InjectionKey, App &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createStore, Store, useStore <span class=\"keyword\">as</span> baseUseStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vuex'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; AllState &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./types'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> createPersistedState <span class=\"keyword\">from</span> <span class=\"string\">'vuex-persistedstate'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> user <span class=\"keyword\">from</span> <span class=\"string\">'./modules/user'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> store = createStore&lt;AllState&gt;(&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    createPersistedState(&#123;</span><br><span class=\"line\">      storage: <span class=\"built_in\">window</span>.sessionStorage,</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  modules: &#123;</span><br><span class=\"line\">    user,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> key: InjectionKey&lt;Store&lt;AllState&gt;&gt; = Symbol(<span class=\"string\">'vue-store'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">useStore</span>&lt;<span class=\"title\">T</span> = <span class=\"title\">AllState</span>&gt;(<span class=\"params\"></span>): <span class=\"title\">Store</span>&lt;<span class=\"title\">T</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> baseUseStore&lt;T&gt;(key)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setupStore</span>(<span class=\"params\">app: App&lt;Element&gt;</span>) </span>&#123;</span><br><span class=\"line\">  app.use(store, key)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// store/types.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> UserState <span class=\"keyword\">from</span> <span class=\"string\">'./modules/user/types'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// eslint-disable-next-line @typescript-eslint/no-empty-interface</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">interface</span> RootState &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">interface</span> AllState <span class=\"keyword\">extends</span> RootState &#123;</span><br><span class=\"line\">  user: UserState</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在 <code>main.ts</code> 中加入 <code>vuex</code></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+  import &#123; setupStore &#125; from './store'</span></span><br><span class=\"line\"></span><br><span class=\"line\">async function bootstrap() &#123;</span><br><span class=\"line\"><span class=\"addition\">+  await setupStore(app)</span></span><br><span class=\"line\">  await setupRouter(app)</span><br><span class=\"line\">  await router.isReady()</span><br><span class=\"line\">  app.mount('#app')</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在 <code>Home/index.vue</code> 中测试是否正确添加</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"home\"</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123; name &#125;&#125; -- &#123;&#123; token &#125;&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">\"changeName('李四')\"</span>&gt;</span>按钮<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"ts\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">import</span> &#123; computed, defineComponent, reactive, toRefs &#125; <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">import</span> &#123; useStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@/store'</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> defineComponent(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">  name: <span class=\"string\">'Home'</span>,</span></span><br><span class=\"line\">  setup() &#123;</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> store = useStore()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> state = reactive(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      msg: <span class=\"string\">'hello, home'</span>,</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> name = computed(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> store.state.user.name)</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> token = computed(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> store.state.user.token)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">changeName</span>(<span class=\"params\">name</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      store.commit(<span class=\"string\">'user/SET_NAME'</span>, name)</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\">      ...toRefs(state),</span><br><span class=\"line\">      name,</span><br><span class=\"line\">      token,</span><br><span class=\"line\">      changeName,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>基本功能已经添加完成了，但作为开发模板还缺少 UI 功能，下一篇补充 UI 框架和 css 框架。</p>\n","categories":[{"name":"vue","path":"api/categories/vue.json"}],"tags":[{"name":"vue3","path":"api/tags/vue3.json"},{"name":"vite","path":"api/tags/vite.json"}]}